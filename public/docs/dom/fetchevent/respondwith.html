<header><h1>FetchEvent.respondWith()</h1></header><div class="section-content">
<div class="notecard experimental" id="sect1"><p><strong>Experimental:</strong> <strong>This is an <a href="https://developer.mozilla.org/en-US/docs/MDN/Writing_guidelines/Experimental_deprecated_obsolete#experimental">experimental technology</a></strong><br>Check the <a href="#browser_compatibility">Browser compatibility table</a> carefully before using this in production.</p></div> <p><a href="../fetchevent"><code>FetchEvent</code></a>의 <code>respondWith()</code> 메소드는 브라우저의 기본 fetch 핸들링을 막고, 당신 스스로 <a href="../response"><code>Response</code></a>에 대한 promise를 제공할 수 있게 허락합니다.</p> <p>대부분의 상황에서 당신은 수신자가 이해하는 어떠한 응답이라도 제공할 수 있습니다. 예를 들어, <a href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/img"><code>&lt;img&gt;</code></a> 엘리먼트가 해당 요청을 시작했다면, 응답 객체는 이미지 데이터를 필요로 합니다. 보안적인 이유들로, 여기엔 몇가지 전역 규칙이 존재합니다.</p> <ul> <li>You can only return <a href="../response"><code>Response</code></a> objects of <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Response/type"><code>type</code> <small>(en-US)</small></a> "<code>opaque</code>" if the <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent/request"><code>fetchEvent.request</code> <small>(en-US)</small></a> object's <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Request/mode"><code>mode</code> <small>(en-US)</small></a> is "<code>no-cors</code>". This prevents the leaking of private data.</li> <li>You can only return <a href="../response"><code>Response</code></a> objects of <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Response/type"><code>type</code> <small>(en-US)</small></a> "<code>opaqueredirect</code>" if the <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent/request"><code>fetchEvent.request</code> <small>(en-US)</small></a> object's <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Request/mode"><code>mode</code> <small>(en-US)</small></a> is "<code>manual</code>".</li> <li>You cannot return <a href="../response"><code>Response</code></a> objects of <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Response/type"><code>type</code> <small>(en-US)</small></a> "<code>cors</code>" if the <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent/request"><code>fetchEvent.request</code> <small>(en-US)</small></a> object's <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Request/mode"><code>mode</code> <small>(en-US)</small></a> is "<code>same-origin</code>".</li> </ul>
</div>
<h3 id="specifying_the_final_url_of_a_resource">Specifying the final URL of a resource</h3>
<div class="section-content">
<p>From Firefox 59 onwards, when a service worker provides a <a href="../response"><code>Response</code></a> to <a href="respondwith" aria-current="page"><code>FetchEvent.respondWith()</code></a>, the <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Response/url"><code>Response.url</code> <small>(en-US)</small></a> value will be propagated to the intercepted network request as the final resolved URL. If the <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Response/url"><code>Response.url</code> <small>(en-US)</small></a> value is the empty string, then the <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Request/url"><code>FetchEvent.request.url</code> <small>(en-US)</small></a> is used as the final URL.</p> <p>In the past the <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Request/url"><code>FetchEvent.request.url</code> <small>(en-US)</small></a> was used as the final URL in all cases. The provided <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Response/url"><code>Response.url</code> <small>(en-US)</small></a> was effectively ignored.</p> <p>This means, for example, if a service worker intercepts a stylesheet or worker script, then the provided <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Response/url"><code>Response.url</code> <small>(en-US)</small></a> will be used to resolve any relative <a href="https://developer.mozilla.org/ko/docs/Web/CSS/@import"><code>@import</code></a> or <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/importScripts"><code>importScripts()</code> <small>(en-US)</small></a> subresource loads (<a href="https://bugzil.la/1222008" target="_blank">Firefox bug 1222008</a>).</p> <p>For most types of network request this change has no impact because you can't observe the final URL. There are a few, though, where it does matter:</p> <ul> <li>If a <a href="../fetch"><code>fetch()</code></a> is intercepted, then you can observe the final URL on the result's <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Response/url"><code>Response.url</code> <small>(en-US)</small></a>.</li> <li>If a <a href="../web_workers_api">worker</a> script is intercepted, then the final URL is used to set <a href="https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/location"><code>self.location</code></a> and used as the base URL for relative URLs in the worker script.</li> <li>If a stylesheet is intercepted, then the final URL is used as the base URL for resolving relative <a href="https://developer.mozilla.org/ko/docs/Web/CSS/@import"><code>@import</code></a> loads.</li> </ul> <p>Note that navigation requests for <a href="../window"><code>Windows</code></a> and <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLIFrameElement"><code>iframes</code> <small>(en-US)</small></a> do NOT use the final URL. The way the HTML specification handles redirects for navigations ends up using the request URL for the resulting <a href="../window/location"><code>Window.location</code></a>. This means sites can still provide an "alternate" view of a web page when offline without changing the user-visible URL.</p>
</div>
<h2 id="syntax">Syntax</h2>
<div class="section-content"><div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="D+iSs5qqBC+PzcH9rFMGmTFW8zoSoXyOQ9Ttd4xgzgc=" data-language="js">fetchEvent<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
  <span class="token comment">// Promise that resolves to a Response.</span>
<span class="token punctuation">)</span>
</pre>
</div></div>
<h3 id="parameters">Parameters</h3>
<div class="section-content"><p>A <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> for a <a href="../response"><code>Response</code></a>.</p></div>
<h3 id="return_value">Return value</h3>
<div class="section-content"><p>Void.</p></div>
<h3 id="exceptions">Exceptions</h3>
<div class="section-content"><figure class="table-container"><div class="_table"><table> <thead> <tr> <th>Exception</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td><code>NetworkError</code></td> <td>A network error is triggered on certain combinations of <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Request/mode"><code>FetchEvent.request.mode</code> <small>(en-US)</small></a> and <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/Response/type"><code>Response.type</code> <small>(en-US)</small></a> values, as hinted at in the "global rules" listed above.</td> </tr> </tbody> </table></div></figure></div>
<h2 id="examples">Examples</h2>
<div class="section-content">
<p>This fetch event tries to return a response from the cache API, falling back to the network otherwise.</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="77fFvGboS0Y1f/IxeLs70a1hB1Ndi3lLkYP4uFHCNv0=" data-language="js"><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Prevent the default, and handle the request ourselves.</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Try to get the response from a cache.</span>
    <span class="token keyword">const</span> cachedResponse <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Return it if we found one.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedResponse<span class="token punctuation">)</span> <span class="token keyword">return</span> cachedResponse<span class="token punctuation">;</span>
    <span class="token comment">// If we didn't find a match in the cache, use the network.</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div>
</div>
<h2 id="명세서">명세서</h2>
<div class="_table"><table class="standard-table">
<thead><tr><th scope="col">Specification</th></tr></thead>
<tbody><tr><td><a href="https://w3c.github.io/ServiceWorker/#fetch-event-respondwith">Service Workers <br><small># fetch-event-respondwith</small></a></td></tr></tbody>
</table></div>
<h2 id="브라우저_호환성">브라우저 호환성</h2>
<p>BCD tables only load in the browser<noscript> with JavaScript enabled. Enable JavaScript to view data.</noscript></p>
<h2 id="see_also">See also</h2>
<div class="section-content"><ul> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers" class="only-in-en-us">Using Service Workers <small>(en-US)</small></a></li> <li><a href="https://jakearchibald.github.io/isserviceworkerready/" target="_blank">Is ServiceWorker ready?</a></li> <li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a></li> <li><a href="../fetch_api">Fetch API</a></li> </ul></div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2023 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/ko/docs/Web/API/FetchEvent/respondWith" class="_attribution-link">https://developer.mozilla.org/ko/docs/Web/API/FetchEvent/respondWith</a>
  </p>
</div>
