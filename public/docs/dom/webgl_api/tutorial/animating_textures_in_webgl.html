<header><h1>WebGL에서의 텍스쳐 애니메이션</h1></header><div class="section-content">
<ul class="prev-next"> <li><a class="button secondary" href="lighting_in_webgl">« 이전</a></li> </ul> <p>앞 단원에서는 정적인 텍스쳐를 사용한 예제를 만들어 봤었는데, 이번에는 Ogg 비디오 파일을 이용해서 텍스쳐에 애니메이션 효과를 적용해 보겠습니다. 사실 만들기 상당히 쉽지만, 그래도 보는 재미는 쏠쏠하니까 한 번 만들어 보겠습니다. 텍스쳐를 구성할 소스로 어떤 종류의 데이터(예를 들면 <a href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/canvas"><code>&lt;canvas&gt;</code></a>와 같은)를 쓰더라도 코드는 비슷할 것입니다.</p>
</div>
<h2 id="텍스쳐를_구성할_비디오_로딩">텍스쳐를 구성할 비디오 로딩</h2>
<div class="section-content">
<p>가장 먼저 할 일은 비디오 프레임을 조회하는데 사용할 <a href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/video"><code>&lt;video&gt;</code></a> 요소를 생성하는 것입니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="MY8PXpx7MYbRx8PKi0D9t6hUi1hYsYzxaHK/Revu8RM=" data-language="js"><span class="token operator">&lt;</span>video id<span class="token operator">=</span><span class="token string">"video"</span><span class="token operator">&gt;</span>
  Your browser doesn't appear to support the <span class="token constant">HTML5</span> <span class="token operator">&lt;</span>code<span class="token operator">&gt;</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>video<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span> element<span class="token punctuation">.</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span>
</pre>
</div> <blockquote> <p>역자 주 : 실제 예제 소스 코드를 보면 비디오 태그가 위와 같이 id 속성만 있는 것이 아니라 아래와 같이 src 속성과 autoplay 속성도 추가되어 있습니다.</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="LwPOSVal1KqloCB777axWkw9UN1KPa/IyYsjXdJYJR4=" data-language="js"><span class="token operator">&lt;</span>video id<span class="token operator">=</span><span class="token string">"video"</span> src<span class="token operator">=</span><span class="token string">"Firefox.ogv"</span> autoplay<span class="token operator">&gt;</span>
  Your browser doesn't appear to support the <span class="token constant">HTML5</span> <span class="token operator">&lt;</span>code<span class="token operator">&gt;</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>video<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span> element<span class="token punctuation">.</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span>
</pre>
</div> </blockquote> <p>위 코드는 'Firefox.ogv" 비디오 파일을 재생할 <a href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/video"><code>&lt;video&gt;</code></a> 요소를 생성합니다. 다음과 같은 CSS 코드를 작성해서 비디오가 자동으로 표시되지 않도록 합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">css</span></p>
<pre data-signature="AKxAxU3Dl/aK3Q1h3vzZ1QLiKMXGRIsiNy0Tw44ZrFY=" data-language="css"><span class="token selector">video</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <p>이제 자바스크립트 코드를 살펴보겠습니다. <code>start()</code> 함수에 비디오 요소에 대한 참조를 가져오는 코드를 추가합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="Dl9PDPQQg10mON+UElZm5wgM5W//DtpyO7QWThbiquM=" data-language="js">videoElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"video"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div> <p><code>setInterval()</code>을 이용해서 <code>drawScene()</code>을 주기적으로 호출하던 코드를 아래의 코드로 대체합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="gXIB69Vc2qA6osDJm1/o8+psEKHjO/wE0PJoeCpOwQM=" data-language="js">videoElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"canplaythrough"</span><span class="token punctuation">,</span> startVideo<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
videoElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"ended"</span><span class="token punctuation">,</span> videoDone<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div> <p>비디오 요소의 src 속성으로 비디오 파일의 위치를 지정해서 비디오 로딩을 시작합니다. FIXME (이 글의 작성자의 한 사람인 bjacob에게) : <code>preload="auto"</code>를 여기에서 명시하지 않으면 파이어폭스에서는 <code>canplaythrough</code> 이벤트가 발생되지 않음. 크롬에서는 <code>preload="auto"</code> 지정 여부와 관계없이 비디오 로딩 시작.</p> <blockquote> <p>역자 주 : 예제에 보면 아래와 같이 자바스크립트에서 preload나 src를 명시하지 않고, 위의 역자 주에 있는 것처럼 비디오 태그 내에 속성값으로 기술하고 있으므로, 바로 위 문단과 아래의 코드는 무시해도 좋을 것 같습니다.</p> </blockquote> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="nhTVx4WvpSdDAIDNIpeYen0CeTHfiecGEVSazaWdfrA=" data-language="js">video<span class="token punctuation">.</span>preload <span class="token operator">=</span> <span class="token string">"auto"</span><span class="token punctuation">;</span>
videoElement<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"Firefox.ogv"</span><span class="token punctuation">;</span>
</pre>
</div> <p>비디오 재생 시 끊김이 없도록 충분히 버퍼링 해둔 후에 애니메이션을 시작하는 것이 좋습니다. 전체 비디오가 끊김 없이 재생될 수 있을만큼 충분한 데이터가 버퍼링 된 후에 비디오의 재생이 시작되도록 아래와 같이 canplaythrough 이벤트에 대한 리스너인 <code>startVideo()</code>를 추가합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="1FwdBWSXCuBFLFKJ7vdBk75LGteTchvmJdKOZAhCf5s=" data-language="js"><span class="token keyword">function</span> <span class="token function">startVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  videoElement<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  intervalID <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>drawScene<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <p>위 코드는 단순히 비디오 재생을 시작하고, 정육면체의 렌더링을 처리하는 <code>drawScene()</code> 함수를 <code>setInterval()</code> 함수를 이용해서 주기적으로 호출합니다.</p> <p>비디오가 끝날 때 방생하는 <code>ended</code> 이벤트에 대한 리스너도 추가해서, 비디오 재생이 끝나면 불필요하게 CPU 시간을 잡아먹지 않도록 애니메이션을 중단시킵니다.</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="UZGrp3vy04qEtBKd+n1F+GpHVY/xjJPf/W/EmIq6xas=" data-language="js"><span class="token keyword">function</span> <span class="token function">videoDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <p><code>videoDone()</code> 함수는 단순히 <a class="only-in-en-us" href="https://developer.mozilla.org/en-US/docs/Web/API/clearInterval"><code>window.clearInterval()</code> <small>(en-US)</small></a> 함수를 호출해서 애니메이션을 업데이트하는 <code>drawScene()</code> 함수의 호출을 중단시킵니다.</p>
</div>
<h2 id="비디오_프레임을_텍스쳐로_사용하기">비디오 프레임을 텍스쳐로 사용하기</h2>
<div class="section-content">
<p>비디오 로딩과 재생에 대한 처리를 마치면, <code>initTexture()</code> 함수의 내용을 변경해야 합니다. 이번에는 이미지를 로딩하는 대신 비어있는 텍스쳐 객체를 생성하고, 텍스쳐 객체를 나중에 사용할 수 있도록 필터링을 설정하기만 하면 되므로, <code>initTexture()</code> 함수의 내용이 앞 단원의 예제보다 조금 더 간단해집니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="7TKSQarnCl0S2LogYNBuE94rZiRtsoJuYds03GVrZWY=" data-language="js"><span class="token keyword">function</span> <span class="token function">initTextures</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cubeTexture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> cubeTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <p>가장 중요한 텍스쳐의 업데이트를 담당하는 <code>updateTexture()</code> 함수는 다음과 같습니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="sPzlfwRpGQvxL/nRLo39WKyNSMkXffPj9NLcT/IZYhc=" data-language="js"><span class="token keyword">function</span> <span class="token function">updateTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> cubeTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> videoElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <p>위와 같은 코드를 전에 본 적이 있을 것입니다. <code>texImage2D()</code> 를 호출할 때 <code>Image</code> 객체를 전달하지 않고 <a href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/video"><code>&lt;video&gt;</code></a> 요소를 전달한다는 것만 제외하면, 앞 단원에서 사용했던 <code>handleTextureLoaded()</code> 루틴과 거의 똑같습니다. 현재의 프레임을 추출해서 텍스쳐로 사용하는 것은 WebGL이 알아서 처리합니다.</p> <p><code>drawScene()</code> 함수에는 맨 앞에 updateTexture()를 추가합니다. <code>drawScene()</code> 함수에 의해 장면을 다시 그릴 때마다 <code>updateTexture()</code> 이 호출됩니다.</p> <p>이제 완성입니다! WebGL을 지원하는 브라우저라면 <a href="http://mdn.github.io/webgl-examples/tutorial/sample8/index.html" target="_blank">여기</a>에서 실제 작동하는 예제를 확인할 수 있습니다.</p>
</div>
<h2 id="참고_자료">참고 자료</h2>
<div class="section-content">
<ul> <li><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Video_and_audio_content" class="only-in-en-us">파이어폭스에서 audio와 video 사용하기 <small>(en-US)</small></a></li> </ul>
<ul class="prev-next"> <li><a class="button secondary" href="lighting_in_webgl">« 이전</a></li> </ul>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2023 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/ko/docs/Web/API/WebGL_API/Tutorial/Animating_textures_in_WebGL" class="_attribution-link">https://developer.mozilla.org/ko/docs/Web/API/WebGL_API/Tutorial/Animating_textures_in_WebGL</a>
  </p>
</div>
