<header><h1>WebGL을 사용한 객체 애니메이션</h1></header><div class="section-content">
<ul class="prev-next"> <li><a class="button secondary" href="using_shaders_to_apply_color_in_webgl">« 이전</a></li> <li><a class="button secondary" href="creating_3d_objects_using_webgl">다음 »</a></li> </ul> <p>앞 단원에서의 예제 코드는 정지되어 있는 것처럼 보이지만 사실은 15밀리초마다 한 번 씩 WebGL 장면(Scene)을 다시 그리도록 설정되어 있습니다. 그려질 객체의 상태가 계속 똑같기 때문에, 똑같은 객체를 15밀리초마다 계속 다시 그리고 있는 것입니다. 이제 우리가 그린 정사각형을 실제로 움직이게 만들어 보겠습니다.</p> <p>이번 예제에서는 2차원 정사각형을 3차원으로 회전시키고 이동시켜 보겠습니다. 3차원을 이루는 X, Y, Z축 방향 모두를 중심으로 회전시켜 보면, 우리가 그린 것은 2차원 정사각형이지만 3차원 공간 안에 존재한다는 것을 실감할 수 있을 것 입니다.</p>
</div>
<h2 id="정사각형_회전시키기">정사각형 회전시키기</h2>
<div class="section-content">
<p>먼저 정사각형을 회전시켜 보겠습니다. 회전 시키려면 회전 상태(회전량)를 저장할 변수가 필요합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="IBPtJ4MdWL6OzBnee1jkl5VR+fuBdG/IF6u5Oy8tdmk=" data-language="js"><span class="token keyword">var</span> squareRotation <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
</pre>
</div> <p>이제 정사각형을 그릴 때 회전을 반영하도록 <code>drawScene()</code> 함수를 수정해야 합니다. 정사각형을 처음에 그려질 위치로 이동시키고 나서 다음과 같이 회전을 적용합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="k+HJ8t41dX6vxgQeAKaLoqHr4RsOw7Gg32iUebYO+WU=" data-language="js"><span class="token function">mvPushMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mvRotate</span><span class="token punctuation">(</span>squareRotation<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div> <p>현재 상태의 모델-뷰 행렬을 저장하고, X축과 Z축을 기준으로 <code>squareRotation</code> 만큼 행렬을 회전시킵니다.</p> <p>정사각형을 그리고 난 후에 모델-뷰 행렬을 원상태로 복구합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="aq9cXAC8VwYNuwnRatlPxVB7ZIJGXJGbUn3mF/bIFwM=" data-language="js"><span class="token function">mvPopMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div> <p>모델-뷰 행렬을 복구하는 이유는 이 회전이 다른 객체에 영향을 미치는 것을 예방하기 위해서 입니다.</p> <p>실제로 애니메이션 효과가 나타나도록 하려면 <code>squareRotation</code> 값을 시간이 지남에 따라 계속 변경해주는 코드를 추가해야 합니다. <code>lastSquareUpdateTime</code>이라는 변수에 마지막으로 다시 그렸던 시각을 저장하고, 다음과 같은 코드를 <code>drawScene()</code>에 추가합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="Kf4g6SAJXMfr0FVfx1TCNvY/3LGLLCcfpCAa1fK9RYs=" data-language="js"><span class="token keyword">var</span> currentTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>lastSquareUpdateTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> delta <span class="token operator">=</span> currentTime <span class="token operator">-</span> lastSquareUpdateTime<span class="token punctuation">;</span>

  squareRotation <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

lastSquareUpdateTime <span class="token operator">=</span> currentTime<span class="token punctuation">;</span>
</pre>
</div> <p>이 코드는 마지막으로 <code>squareRotation</code>의 값을 변경한 시각과 현재 시각과의 차이를 이용해서 회전량을 나타내는 <code>squareRotation</code>의 값을 결정 합니다.</p>
</div>
<h2 id="정사각형_이동시키기">정사각형 이동시키기</h2>
<div class="section-content">
<p>정사각형을 그리기 전에 위치값을 변경하면 정사각형을 이동시킬 수 있습니다. 이번 예제에서는 학습을 목적으로 아주 기초적인 애니메이션을 구현해봅니다. 실전에서 이런 식으로 애니메이션을 구현하면 사람들에게 사랑받지 못할 것입니다.</p> <p>X, Y, Z 각 축별 오프셋(offset) 값을 새 변수에 저장합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="LVUTL6PaBaSs6FZbbD1h3dRD27bhDT3Hh/ap2u/okWs=" data-language="js"><span class="token keyword">var</span> squareXOffset <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> squareYOffset <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> squareZOffset <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
</pre>
</div> <p>축 별 위치 변동값을 다음과 같이 각기 다른 값으로 지정합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="JmTiDo8i6HSWksf3iL5Va9SyE9ykYHy87q3obXmTIgQ=" data-language="js"><span class="token keyword">var</span> xIncValue <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> yIncValue <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> zIncValue <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
</pre>
</div> <p>이제 위치 변동값을 계산하는 코드를 위에서 구현한 회전량 계산 코드 바로 아래에 추가합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="P+gHOzknH+G1bhWvljx3PRKvEJLqWjO05eMeEIe3J/A=" data-language="js">squareXOffset <span class="token operator">+=</span> xIncValue <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
squareYOffset <span class="token operator">+=</span> yIncValue <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
squareZOffset <span class="token operator">+=</span> zIncValue <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> delta<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>squareYOffset<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  xIncValue <span class="token operator">=</span> <span class="token operator">-</span>xIncValue<span class="token punctuation">;</span>
  yIncValue <span class="token operator">=</span> <span class="token operator">-</span>yIncValue<span class="token punctuation">;</span>
  zIncValue <span class="token operator">=</span> <span class="token operator">-</span>zIncValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <p>마지막으로 다음 코드를 <code>drawScene()</code> 함수에 추가합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="rko5FosbDk7lQiXdXQzvHhqiJEkHME6BXrTNBMMb2LI=" data-language="js"><span class="token function">mvTranslate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>squareXOffset<span class="token punctuation">,</span> squareYOffset<span class="token punctuation">,</span> squareZOffset<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div> <p>이제 정사각형이 화면에서 좌, 우, 위, 아래, 앞, 뒤로 완전히 자기멋대로 움직이면서 회전하는 것을 볼 수 있습니다. 어찌보면 바탕화면 보호기 같기도 합니다.</p> <p>WebGL이 지원되는 브라우저라면, <a href="http://mdn.github.io/webgl-examples/tutorial/sample4/index.html" target="_blank">여기</a>에서 실제 동작하는 예제를 확인할 수 있습니다.</p>
</div>
<h2 id="추가적인_행렬_연산">추가적인 행렬 연산</h2>
<div class="section-content">
<p>아래의 예제는 스택을 사용하는 두 개의 push, pop 루틴과, 주어진 각도만큼 회전시키는 행렬을 포함하는 몇 가지 추가적인 행렬 연산을 사용합니다. 한 번 참고하시기 바랍니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="/rF72btQ1XRdEluLdPkXnhp3VJfMr6qgrNxm4eWedH8=" data-language="js"><span class="token keyword">var</span> mvMatrixStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">mvPushMatrix</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mvMatrixStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mvMatrix <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    mvMatrixStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>mvMatrix<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mvPopMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mvMatrixStack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token string">"Can't pop from an empty matrix stack."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  mvMatrix <span class="token operator">=</span> mvMatrixStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> mvMatrix<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mvRotate</span><span class="token punctuation">(</span><span class="token parameter">angle<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> inRadians <span class="token operator">=</span> angle <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180.0</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> m <span class="token operator">=</span> Matrix<span class="token punctuation">.</span><span class="token function">Rotation</span><span class="token punctuation">(</span>inRadians<span class="token punctuation">,</span> $<span class="token constant">V</span><span class="token punctuation">(</span><span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ensure4x4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">multMatrix</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <p>이 루틴은 예전에 Vlad Vukićević가 작성했던 예제를 참고하여 만들었습니다.</p>
<ul class="prev-next"> <li><a class="button secondary" href="using_shaders_to_apply_color_in_webgl">« 이전</a></li> <li><a class="button secondary" href="creating_3d_objects_using_webgl">다음 »</a></li> </ul>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2023 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/ko/docs/Web/API/WebGL_API/Tutorial/Animating_objects_with_WebGL" class="_attribution-link">https://developer.mozilla.org/ko/docs/Web/API/WebGL_API/Tutorial/Animating_objects_with_WebGL</a>
  </p>
</div>
