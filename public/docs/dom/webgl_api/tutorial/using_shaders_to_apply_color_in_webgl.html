<header><h1>WebGL에서 셰이더를 사용하여 색상 적용하기</h1></header><div class="section-content">
<ul class="prev-next"> <li><a class="button secondary" href="adding_2d_content_to_a_webgl_context">« 이전</a></li> <li><a class="button secondary" href="animating_objects_with_webgl">다음 »</a></li> </ul> <p><a href="adding_2d_content_to_a_webgl_context">앞 단원의 예제</a>에서 정사각형을 그려봤으니, 이제 정사각형에 색을 칠해 보겠습니다. 셰이더를 조금 수정하면 색을 칠할 수 있습니다.</p>
</div>
<h2 id="정점에_색상_적용">정점에 색상 적용</h2>
<div class="section-content">
<p>GL(Graphic Library)에서 객체는 정점의 집합으로 구성되며, 각 정점은 위치값과 색상값을 가지고 있습니다. 기본적으로 정점이 아닌 모든 픽셀의 색상값은 선형 보간법(linear interpolation)을 이용해서 계산됩니다. 색상 뿐 아니라 위치를 포함한 다른 모든 속성들도 마찬가지로 선형 보간법으로 계산됩니다. 색상의 경우 선형 보간법을 통해 보간되면 자연스럽게 부드러운 그라데이션(gradation)이 형성됩니다. 앞 단원에서는 정점 셰이더에서 정점에 아무런 색상도 적용하지 않았습니다. 대신에 프래그먼트 셰이더에서 각 픽셀에 흰색을 적용했기 때문에 전체 사각형이 흰색으로 그려질 수 있었습니다.</p> <p>이제 정사각형의 각 꼭지점에 빨간색, 파란색, 녹색, 흰색을 적용해 보겠습니다. 정점이 아닌 픽셀들은 선형 보간에 의해 그라데이션이 형성됩니다. 먼저 네 개의 정점에 색을 지정하겠습니다. 정점에 색을 지정하려면 정점의 색상값을 가진 배열을 만들고, 이 배열을 WebGL 버퍼에 저장해야 합니다. <code>initBuffers()</code> 함수에 아래의 내용을 추가합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="w4IiRiNzu6S99MOaQLuQV1Z7TRYj+sdgs+gMo1U+Y1U=" data-language="js">  <span class="token keyword">var</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span>    <span class="token comment">// 흰색</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span>    <span class="token comment">// 빨간색</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span>    <span class="token comment">// 녹색</span>
    <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token number">1.0</span>     <span class="token comment">// 파란색</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  squareVerticesColorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> squareVerticesColorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
</div> <p>먼저 정점에 지정할 색상값을 가진 자바스크립트 배열을 생성합니다. 4개의 원소가 하나의 색을 나타내며, 정사각형의 4개의 꼭지점에 흰색, 빨간색, 파란색, 녹색이 지정되도록 값을 정합니다. 이 색상 정보 배열을 저장하기 위해 새로운 WebGL 버퍼를 생성하고, 배열은 부동소수점 형식으로 WebGL의 버퍼에 저장합니다.</p> <p>이 색상 정보를 실제 렌더링에 사용하려면, 컬러 버퍼에서 색상 정보를 읽을 수 있도록 정점 셰이더를 수정해야 합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">html</span></p>
<pre data-signature="VCMhfQ/WvRyqZ7E2q//nrPJoPi/1BrTzw+adtlK+cts=" data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shader-vs<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x-shader/x-vertex<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec3 aVertexPosition<span class="token punctuation">;</span>
  attribute vec4 aVertexColor<span class="token punctuation">;</span>

  uniform mat4 uMVMatrix<span class="token punctuation">;</span>
  uniform mat4 uPMatrix<span class="token punctuation">;</span>

  varying lowp vec4 vColor<span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> uPMatrix <span class="token operator">*</span> uMVMatrix <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aVertexPosition<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vColor <span class="token operator">=</span> aVertexColor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre>
</div> <p>수정 전의 소스와 가장 많이 달라진 점은, 색상 배열에서 읽은 값을 토대로 각 정점에 색상값을 지정했다는 점입니다.</p>
</div>
<h2 id="프래그먼트에_색상_입히기">프래그먼트에 색상 입히기</h2>
<div class="section-content">
<p>앞 단원에서 사용했던 프래그먼트 셰이더를 다시 한 번 보겠습니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">html</span></p>
<pre data-signature="FQfn/A7nOyChBHAypBgg4UYRq3/bfiT42oCGPCxmC2I=" data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shader-fs<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x-shader/x-fragment<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre>
</div> <p>프래그먼트에 색상 입히기는 아주 쉽습니다. 위와 같이 프래그먼트 셰이더 내에서 흰색을 지정해주는 대신 단순히 <code>vColor</code> 변수에서 값을 읽어오도록 수정하기만 하면, 각 픽셀 별로 보간된 색상값을 구할 수 있습니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">html</span></p>
<pre data-signature="VxLq+YENPT3qZpzlnt/Ty7sAoIvVBzVYL4ROG+mN3n8=" data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shader-fs<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x-shader/x-fragment<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  varying lowp vec4 vColor<span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> vColor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</pre>
</div> <p>위와 같이 각 프래그먼트는 정점을 기준으로 상대적인 위치에 따라 선형 보간된 색상값을 갖게 됩니다.</p>
</div>
<h2 id="색상을_적용해서_그리기">색상을 적용해서 그리기</h2>
<div class="section-content">
<p>이제 셰이더 프로그램에서 색상 변수를 초기화하고 활성화하는 내용을 <code>initShaders()</code>에 추가합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="oOUbz+vZ5kS4MsbF2OlJtsCkjHmeFEYubrX/TaNYlko=" data-language="js">vertexColorAttribute <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> <span class="token string">"aVertexColor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>vertexColorAttribute<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div> <p>다음은 정사각형을 그릴 때 색상 정보를 사용하도록 <code>drawScene()</code>을 수정합니다:</p> <div class="code-example">
<p class="example-header"><span class="language-name">js</span></p>
<pre data-signature="I1TAJ5Rpx9yxQRxNjQ6xDcrIcm4I5Wgac6ClbOg0VGs=" data-language="js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> squareVerticesColorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>vertexColorAttribute<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
</div> <p>이제 WebGL이 호환되는 브라우저에서 <a href="http://mdn.github.io/webgl-examples/tutorial/sample3/index.html" target="_blank">샘플</a>을 보면, 검정색 바탕에 아래와 같은 정사각형이 그려지는 것을 볼 수 있습니다:</p>
<iframe width="670" height="510" src="https://mdn.github.io/dom-examples/webgl-examples/tutorial/sample3/index.html" loading="lazy"></iframe> <p><a href="https://github.com/mdn/dom-examples/tree/main/webgl-examples/tutorial/sample3" target="_blank">전체 코드 보기</a> | <a href="https://mdn.github.io/dom-examples/webgl-examples/tutorial/sample3/" target="_blank">새창에서 데모 실행하기</a></p>
<ul class="prev-next"> <li><a class="button secondary" href="adding_2d_content_to_a_webgl_context">« 이전</a></li> <li><a class="button secondary" href="animating_objects_with_webgl">다음 »</a></li> </ul>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2023 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/ko/docs/Web/API/WebGL_API/Tutorial/Using_shaders_to_apply_color_in_WebGL" class="_attribution-link">https://developer.mozilla.org/ko/docs/Web/API/WebGL_API/Tutorial/Using_shaders_to_apply_color_in_WebGL</a>
  </p>
</div>
